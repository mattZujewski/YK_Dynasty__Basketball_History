<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trade Cards &mdash; YK Dynasty Basketball</title>
  <script>if(localStorage.getItem('yk_theme')==='dark')document.documentElement.classList.add('dark');</script>
  <link rel="stylesheet" href="css/style.css" />
  <style>
    .cross-links {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 16px;
      font-size: 0.85rem;
    }
    .cross-links a {
      color: var(--brand-green);
      text-decoration: none;
      padding: 5px 12px;
      border: 1px solid var(--border);
      border-radius: 99px;
      transition: var(--transition);
    }
    .cross-links a:hover { background: var(--bg-card); box-shadow: var(--shadow-sm); }

    /* Trade card grid */
    .trade-cards-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }
    @media (max-width: 720px) {
      .trade-cards-grid { grid-template-columns: 1fr; }
    }
    .trade-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      overflow: hidden;
      box-shadow: var(--shadow-sm);
      transition: box-shadow var(--transition);
    }
    .trade-card:hover { box-shadow: var(--shadow-md); }
    .trade-card.collusion-card { border-color: rgba(230,57,70,0.4); opacity: 0.7; }
    .trade-card-header {
      padding: 10px 14px 8px;
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      font-size: 0.8rem;
      color: var(--text-muted);
    }
    .trade-card-header .trade-id {
      font-weight: 700;
      color: var(--text-primary);
      font-size: 0.85rem;
    }
    .trade-card-sides {
      display: flex;
      min-height: 120px;
    }
    .trade-side {
      flex: 1;
      padding: 12px 14px;
      min-width: 0;
    }
    .trade-side-owner {
      font-weight: 700;
      font-size: 0.88rem;
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
    }
    .owner-dot {
      width: 9px; height: 9px;
      border-radius: 50%;
      flex-shrink: 0;
    }
    .winner-badge {
      font-size: 0.65rem;
      font-weight: 700;
      background: rgba(42,157,143,0.15);
      color: var(--brand-green);
      padding: 1px 6px;
      border-radius: 99px;
    }
    .winner-flipped-badge {
      font-size: 0.65rem;
      font-weight: 700;
      background: rgba(232,184,75,0.18);
      color: #c7960a;
      padding: 1px 6px;
      border-radius: 99px;
    }
    .winner-history { font-size: 0.72rem; color: var(--text-muted); margin-bottom: 4px; line-height: 1.3; }
    .winner-stable  { color: var(--brand-green); }
    .winner-flipped-text { color: #c7960a; }
    .trade-side-total {
      font-size: 1.05rem;
      font-weight: 800;
      color: var(--text-primary);
      margin-bottom: 6px;
    }
    .asset-list {
      list-style: none;
      padding: 0;
      margin: 0;
      font-size: 0.76rem;
    }
    .asset-list li {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 2px 0;
      color: var(--text-secondary);
      border-bottom: 1px dashed var(--border);
      gap: 4px;
    }
    .asset-list li:last-child { border-bottom: none; }
    .asset-list .asset-name { flex: 1; min-width: 0; }
    .asset-list .asset-val { font-weight: 600; color: var(--text-primary); flex-shrink: 0; }
    .asset-list .asset-zero { color: var(--text-muted); font-style: italic; }
    .trade-vs-divider {
      width: 1px;
      background: var(--border);
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .trade-vs-label {
      position: absolute;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 50%;
      width: 22px; height: 22px;
      display: flex; align-items: center; justify-content: center;
      font-size: 0.62rem;
      font-weight: 700;
      color: var(--text-muted);
      z-index: 1;
    }
    .trade-card-footer {
      padding: 8px 14px;
      background: var(--bg-primary);
      border-top: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }
    .margin-bar-wrap {
      flex: 1;
      min-width: 100px;
    }
    .margin-bar-track {
      height: 6px;
      background: var(--border);
      border-radius: 99px;
      overflow: hidden;
    }
    .margin-bar-fill {
      height: 100%;
      border-radius: 99px;
      background: var(--brand-green);
      transition: width 0.3s;
    }
    .margin-label {
      font-size: 0.72rem;
      color: var(--text-muted);
      margin-top: 2px;
    }
    .tvot-link {
      font-size: 0.72rem;
      color: var(--brand-green);
      text-decoration: none;
      white-space: nowrap;
    }
    .tvot-link:hover { text-decoration: underline; }
    .collusion-tag {
      font-size: 0.7rem;
      color: var(--status-ir);
      background: rgba(230,57,70,0.1);
      padding: 1px 6px;
      border-radius: 4px;
    }

    /* Party count badge */
    .party-tag { font-size: 0.7rem; padding: 1px 6px; border-radius: 4px; }
    .party-tag-2     { background: rgba(0,0,0,0.05); color: var(--text-muted); }
    .party-tag-multi { background: rgba(74,181,241,0.15); color: #2a6ba8; }

    /* Featured section heading */
    .featured-label {
      display: inline-block;
      font-size: 0.7rem;
      font-weight: 700;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      padding: 2px 8px;
      border-radius: 4px;
      margin-bottom: 8px;
    }
    .featured-win  { background: rgba(42,157,143,0.15); color: var(--brand-green); }
    .featured-loss { background: rgba(230,57,70,0.12); color: var(--status-ir); }
    .featured-fair { background: rgba(74,181,241,0.12); color: #2a6ba8; }

    /* Collapsible section toggle */
    .section-toggle {
      font-size: 0.78rem; background: none; border: none; color: var(--text-muted);
      cursor: pointer; padding: 0; margin-bottom: 8px; display: block;
    }
    .section-toggle:hover { color: var(--text-primary); }
    .grid-collapsed { display: none; }

    /* Filter bar & select */
    .filter-sep { color: var(--border); margin: 0 4px; }

    /* Season filter bar */
    .season-filter-bar { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; margin-bottom: 14px; }
    .season-filter-label { font-size: 0.82rem; color: var(--text-muted); margin-right: 2px; }
    .sfb-btn {
      padding: 4px 10px; border: 1px solid var(--border); border-radius: 99px;
      background: var(--bg-input); color: var(--text-secondary); font-size: 0.8rem;
      cursor: pointer; transition: var(--transition);
    }
    .sfb-btn.active { background: var(--brand-green); color: #fff; border-color: var(--brand-green); }
    .sfb-btn.sfb-disabled { opacity: 0.45; cursor: not-allowed; }
    .sfb-btn:hover:not(.sfb-disabled):not(.active) { background: var(--bg-card); }

    @media (max-width: 600px) {
      .trade-card-sides { flex-direction: column; }
      .trade-vs-divider { display: none; }
    }
    #cards-count { font-size: 0.82rem; color: var(--text-muted); margin: 6px 0 8px; }

    /* Tooltip */
    [data-tooltip] { position: relative; cursor: help; }
    [data-tooltip]::after {
      content: attr(data-tooltip);
      position: absolute; bottom: calc(100% + 6px); left: 50%;
      transform: translateX(-50%);
      background: #1a1d27; color: #e8eaf6;
      font-size: 0.72rem; padding: 5px 10px; border-radius: 6px;
      white-space: normal; max-width: 220px; text-align: center;
      pointer-events: none; opacity: 0; transition: opacity 0.15s;
      z-index: 100; line-height: 1.4;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    [data-tooltip]:hover::after { opacity: 1; }

    /* TVOT mini-bar in card footer */
    .tvot-mini-bar { display: flex; height: 36px; border-radius: 4px; overflow: hidden; gap: 2px; margin: 6px 0 2px; }
    .tvot-mini-seg {
      flex: 1; display: flex; flex-direction: column;
      align-items: center; justify-content: center; gap: 1px;
    }
    .tvot-mini-seg.flip-point { box-shadow: inset 0 0 0 2px rgba(255,255,255,0.6); }
    .tvot-mini-yr     { font-size: 0.55rem; opacity: 0.85; line-height: 1; color: rgba(255,255,255,0.9); }
    .tvot-mini-margin { font-size: 0.6rem; font-weight: 700; line-height: 1; color: rgba(255,255,255,0.95); }

    /* Multi-party trade cards span full grid width */
    .trade-cards-grid .multi-party-card { grid-column: 1 / -1; }

    /* Asset list column header */
    .asset-list-header {
      display: flex; justify-content: space-between;
      font-size: 0.63rem; font-weight: 600; text-transform: uppercase;
      color: var(--text-muted); margin: 5px 0 2px;
    }

    /* Owner pills bar: wraps to 2 rows of 5 on desktop */
    @media (min-width: 769px) {
      #owner-pills-bar { max-width: 520px; }
    }
    /* Tighter trade card padding on desktop */
    @media (min-width: 769px) {
      .trade-card-header { padding: 7px 12px 6px; }
      .trade-side { padding: 10px 12px; }
      .trade-card-footer { padding: 6px 12px; }
    }
    /* Stat cards: centered text */
    .stat-card .stat-label { text-align: center; }
    .stat-card .stat-value { text-align: center; word-break: break-word; }
    /* Clickable stat cards */
    .stat-card[data-clickable] { cursor: pointer; }
    .stat-card[data-clickable]:hover { box-shadow: var(--shadow-lg); transform: translateY(-2px); }

  </style>
</head>
<body>
  <script src="js/nav.js"></script>

  <main class="page-container">
    <div id="sticky-season" class="sticky-season-pill"></div>
    <header class="page-header">
      <h1>&#x1F0CF; Trade Cards</h1>
      <p class="subtitle">Every graded trade &mdash; both sides, asset values, and winners (2021&ndash;22 to present)</p>
    </header>

    <!-- Season filter bar (top of page) -->
    <div id="season-filter-bar"></div>
    <p id="multi-party-note" class="chart-insight" style="display:none"></p>

    <!-- Cross-links -->
    <div class="cross-links">
      <a href="trade-leaderboard.html">&#x1F4CA; Trade Leaderboard</a>
      <a href="trade-value-over-time.html">&#x23F3; TVOT</a>
    </div>

    <!-- Summary stat cards -->
    <div class="stat-row" id="summary-cards" style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:20px"></div>

    <!-- Top 5 Most Lopsided (collapsed by default) -->
    <div class="chart-section">
      <div class="section-header-row">
        <span class="featured-label featured-win">&#x1F3C6; Top 5 Biggest Wins</span>
        <span class="section-header-title">Most Lopsided Trades</span>
      </div>
      <button class="section-toggle" data-target="top-wins-grid">&#x25BA; Expand</button>
      <div class="trade-cards-grid grid-collapsed" id="top-wins-grid">
        <p class="text-muted" style="padding:12px">Loading&hellip;</p>
      </div>
    </div>

    <!-- Top 5 Closest (collapsed by default) -->
    <div class="chart-section">
      <div class="section-header-row">
        <span class="featured-label featured-fair">&#x1F91D; Top 5 Closest</span>
        <span class="section-header-title">Most Evenly Matched Trades</span>
      </div>
      <button class="section-toggle" data-target="closest-grid">&#x25BA; Expand</button>
      <div class="trade-cards-grid grid-collapsed" id="closest-grid">
        <p class="text-muted" style="padding:12px">Loading&hellip;</p>
      </div>
    </div>

    <!-- Biggest Comebacks (collapsed by default) -->
    <div class="chart-section" id="comebacks-section">
      <div class="section-header-row">
        <span class="featured-label featured-fair">&#x1F504; Biggest Comebacks <span id="comebacks-count" style="font-weight:400;color:var(--text-muted);font-size:0.9rem"></span></span>
        <span class="section-header-title">Trades where the winner flipped</span>
      </div>
      <p class="chart-description">Trades where the winner changed over time &mdash; ranked by swing magnitude.</p>
      <button class="section-toggle" data-target="comebacks-list">&#x25BA; Expand</button>
      <div id="comebacks-list" class="trade-cards-grid grid-collapsed"></div>
    </div>

    <!-- Collusion mode banner -->
    <div id="collusion-banner" class="collusion-mode-banner" style="display:none">
      &#x1F575;&#xFE0F; Viewing collusion flags &mdash; all other filters suspended.
      <button id="collusion-banner-exit">Exit</button>
    </div>

    <!-- All Trades -->
    <div class="chart-section" id="all-trades-section">
      <h2><span id="all-trades-label">All Trade Grades</span> <span id="cards-count-inline" style="font-size:0.8rem;font-weight:400;color:var(--text-muted)"></span></h2>
      <p class="chart-description">Filter and sort all graded trades. Click &ldquo;TVOT&rdquo; to see how a trade&rsquo;s value changed over time.</p>

      <!-- Row 1: Owner pills -->
      <div class="filter-row">
        <div id="owner-pills-bar" class="owner-pill-bar"></div>
      </div>
      <!-- Row 2: Sort + Collusion + Reset -->
      <div class="filter-row">
        <button class="filter-btn active" data-sortby="margin">Biggest Margin</button>
        <button class="filter-btn" data-sortby="recent">Most Recent</button>
        <button class="filter-btn" data-sortby="fair">Closest First</button>
        <span class="filter-sep">|</span>
        <button id="collusion-icon-btn" class="collusion-icon-btn" title="Show collusion flags â€” overrides all filters">&#x1F575;&#xFE0F;</button>
        <button id="reset-filters-btn" class="reset-filters-btn">&#x21BA; Reset Filters</button>
      </div>

      <p id="cards-count"></p>
      <div id="all-trades-list"></div>
    </div>
  </main>

  <script src="js/core.js"></script>
  <script src="js/dashboards/trade_cards.js"></script>
</body>
</html>