<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trade Leaderboard &mdash; YK Dynasty Basketball</title>
  <script>if(localStorage.getItem('yk_theme')==='dark')document.documentElement.classList.add('dark');</script>
  <link rel="stylesheet" href="css/style.css" />
  <script src="js/chart.umd.min.js"></script>
  <script src="js/chartjs-fix.js"></script>
  <style>
    /* Season filter bar */
    .season-filter-bar { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; margin-bottom: 14px; }
    .season-filter-label { font-size: 0.82rem; color: var(--text-muted); margin-right: 2px; }
    .sfb-btn {
      padding: 4px 10px; border: 1px solid var(--border); border-radius: 99px;
      background: var(--bg-input); color: var(--text-secondary); font-size: 0.8rem;
      cursor: pointer; transition: var(--transition);
    }
    .sfb-btn.active { background: var(--brand-green); color: #fff; border-color: var(--brand-green); }
    .sfb-btn.sfb-disabled { opacity: 0.45; cursor: not-allowed; }
    .sfb-btn:hover:not(.sfb-disabled):not(.active) { background: var(--bg-card); }

    /* Drill-down rows */
    .drill-row { display: none; }
    .drill-row.open { display: table-row; }
    .drill-inner { padding: 10px 16px 14px; background: var(--bg-primary); }
    .drill-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 6px;
      margin-top: 8px;
    }
    .drill-item {
      display: flex;
      flex-direction: column;
      gap: 3px;
      padding: 5px 8px;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 0.78rem;
      background: var(--bg-card);
    }
    .drill-item-row {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }
    .drill-item-result { font-weight: 600; }
    .drill-item-result.win  { color: var(--brand-green); }
    .drill-item-result.loss { color: var(--status-ir); }
    .drill-item-row a {
      color: var(--brand-green);
      text-decoration: none;
      margin-left: auto;
      white-space: nowrap;
      font-size: 0.75rem;
    }
    .drill-item-row a:hover { text-decoration: underline; }
    .drill-assets {
      font-size: 0.72rem;
      color: var(--text-muted);
      padding-top: 2px;
      border-top: 1px dashed var(--border);
    }
    .standings-row { cursor: pointer; }
    .standings-row:hover td { background: var(--bg-primary); }
    .drill-arrow { font-size: 0.7rem; color: var(--text-muted); margin-left: 4px; }

    /* Tooltip */
    [data-tooltip] { position: relative; }
    [data-tooltip]::after {
      content: attr(data-tooltip);
      position: absolute; bottom: calc(100% + 6px); left: 50%;
      transform: translateX(-50%);
      background: #1a1d27; color: #e8eaf6;
      font-size: 0.72rem; padding: 5px 10px; border-radius: 6px;
      white-space: normal; max-width: 260px; text-align: center;
      pointer-events: none; opacity: 0; transition: opacity 0.15s;
      z-index: 100; line-height: 1.4;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    [data-tooltip]:hover::after { opacity: 1; }
    .info-icon { font-size: 0.72rem; color: var(--text-muted); cursor: help; margin-left: 3px; opacity: 0.75; }

    /* Mobile: transform standings table into cards */
    @media (max-width: 640px) {
      #overall-table thead { display: none; }
      #overall-table tbody tr.standings-row {
        display: block;
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: var(--radius-md);
        margin-bottom: 10px;
        padding: 10px 14px;
      }
      #overall-table tbody tr.standings-row td {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 4px 0;
        border: none;
        font-size: 0.85rem;
        text-align: left !important;
      }
      #overall-table tbody tr.standings-row td::before {
        content: attr(data-label);
        color: var(--text-muted);
        font-size: 0.72rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.04em;
      }
      #overall-table tbody tr.standings-row td[data-label=""] {
        justify-content: center;
        font-size: 1rem;
        padding-bottom: 6px;
        border-bottom: 1px solid var(--border);
        margin-bottom: 4px;
      }
      #overall-table tbody tr.standings-row td[data-label=""]::before { display: none; }
      /* Drill row must be display:block on mobile, not display:table-row */
      .drill-row.open { display: block; }
      .drill-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <script src="js/nav.js"></script>

  <main class="page-container">
    <header class="page-header">
      <h1>&#x1F4CA; Trade Leaderboard</h1>
      <p class="subtitle">Dynasty trade grades by owner &mdash; who wins trades? (2021&ndash;22 to present)</p>
    </header>

    <!-- Cross-links -->
    <div class="cross-links" style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:16px;font-size:0.85rem">
      <a href="trade-value-over-time.html" style="color:var(--brand-green);text-decoration:none;padding:5px 12px;border:1px solid var(--border);border-radius:99px;transition:var(--transition)">&#x23F3; Trade Trends</a>
      <a href="trade-cards.html" style="color:var(--brand-green);text-decoration:none;padding:5px 12px;border:1px solid var(--border);border-radius:99px;transition:var(--transition)">&#x1F0CF; Trade Cards</a>
    </div>

    <!-- Season filter bar -->
    <div id="season-filter-bar"></div>

    <!-- Summary stat cards -->
    <div class="stat-row" id="summary-cards" style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:16px"></div>

    <!-- Overall Standings Table -->
    <div class="chart-section">
      <h2>Overall Trade Grade Standings</h2>
      <p class="chart-description">Cumulative win/loss record and margin across all graded trades (2021&ndash;22 to present). Click a row to see individual trade grades.</p>
      <div class="data-table-wrapper">
        <table class="data-table" id="overall-table">
          <thead>
            <tr>
              <th style="width:44px">Rank</th>
              <th>Owner</th>
              <th style="text-align:center">W</th>
              <th style="text-align:center">L</th>
              <th style="text-align:center">Win %</th>
              <th style="text-align:right">Total Margin <span class="info-icon" data-tooltip="Sum of dynasty value gained across all trade wins in the selected period.">&#x2139;</span></th>
              <th style="text-align:right">Avg Margin <span class="info-icon" data-tooltip="Dynasty value = Weighted FPPG &times; age multiplier &times; star premium &times; durability modifier. Higher = better dynasty asset.">&#x2139;</span></th>
            </tr>
          </thead>
          <tbody id="overall-tbody">
            <tr><td colspan="7" class="text-center text-muted" style="padding:24px">Loading&hellip;</td></tr>
          </tbody>
        </table>
      </div>
      <p class="chart-insight" id="overall-insight"></p>
    </div>

    <!-- Win% Bar Chart -->
    <div class="chart-section">
      <h2>Trade Win Percentage by Owner</h2>
      <p class="chart-description">Higher = better dynasty trade performance. Based on dynasty value calculations (Weighted FPPG &times; Dynasty Mult &times; Star Premium &times; GP Modifier).</p>
      <div class="chart-wrapper" style="height:360px">
        <canvas id="chart-winpct"></canvas>
      </div>
    </div>

    <!-- About section -->
    <div class="chart-section">
      <h2>About Trade Grades</h2>
      <p class="chart-description">
        Trade grades are calculated using the YK Trade Analyzer formula:
        <strong>Dynasty Value = Weighted FPPG &times; Dynasty Multiplier &times; Star Premium &times; GP Modifier</strong>.
        The owner who received the higher-value side wins the trade grade.
        Collusion-flagged trades (IDs 99 &amp; 111) are excluded.
        Coverage: trades from the 2021&ndash;22 season onward.
        Only players with Fantrax data (current or historical) are included.
      </p>
    </div>
  </main>

  <script src="js/core.js"></script>
  <script src="js/dashboards/trade_leaderboard.js"></script>
</body>
</html>